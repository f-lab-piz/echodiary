# spec-admin-llm-provider

## Problem
- 모델 공급자/모델 선택 정책이 없으면 운영 중 비용, 품질, 장애 대응이 불안정해진다.
- 서비스 전체 모델 전략을 일관되게 제어할 관리 기능이 필요하다.

## Target User
- 서비스 운영 관리자 계정.

## User Value
- 공급자 전환을 단일 설정으로 통제해 운영 리스크를 줄인다.
- 모델 타입별 라우팅을 표준화해 예측 가능한 품질/비용 관리를 가능하게 한다.

## Use Cases
- 관리자가 `OpenAI` 또는 `Gemini`를 선택해 서버 전역 공급자를 설정한다.
- 관리자가 `text-small`, `text-large`, `image`의 실제 모델명을 설정한다.
- 관리자가 장애/비용 이슈 시 공급자를 전환한다.

## Corner Cases
- 공급자 전환 시점에 실행 중 요청이 존재하는 경우.
- 선택 공급자의 특정 모델 타입만 장애인 경우.
- 잘못된 모델명 저장으로 요청 실패가 연쇄 발생하는 경우.

## Behavior Spec
- 지원 공급자는 `OpenAI`, `Gemini` 두 가지로 제한한다.
- 관리자 설정은 전역 단일값(`provider`)으로 관리한다.
- 모델 타입은 공통 키 `text-small`, `text-large`, `image`를 사용한다.
- 각 타입은 공급자별 실제 모델명 매핑으로 실행한다.
- 공급자 변경 저장 후 `신규 요청`부터 변경된 설정을 적용한다.
- 실행 중 요청은 기존 설정으로 완료 처리한다.
- 선택 공급자 장애 시 자동 타공급자 폴백은 MVP에서 제공하지 않는다.
- 장애 시 요청은 빠른 실패 + 재시도 경로를 제공한다.
- 관리자 화면에서 현재 공급자, 모델 매핑, 최근 오류율 요약을 확인할 수 있어야 한다.

## Cost and Complexity
- 다중 공급자 지원은 설정/검증/모니터링 비용이 증가한다.
- 저비용 대안은 단일 공급자 고정 운영이다.
- 단일 고정 대안은 구현이 단순하지만 장애/비용 변동 대응력이 낮다.

## Usability
- 관리자 UI는 한 화면에서 공급자 선택과 모델 매핑 편집을 완료하도록 단순화한다.
- 저장 전 모델명 유효성 검사로 오입력 리스크를 줄인다.

## Risks and Mitigations
- Risk: 공급자별 응답 형식 차이로 결과 품질 편차 발생.
- Mitigation: 공통 프롬프트 스키마와 출력 정규화 레이어 적용.
- Risk: 설정 변경 직후 오류 증가.
- Mitigation: 변경 이력 기록 + 즉시 롤백 버튼 제공.
- Risk: 공급자 장애 시 전체 실패율 증가.
- Mitigation: 운영 런북 기반 수동 전환 절차와 빠른 실패 정책 적용.

## Decision
- 모델 공급자 정책은 `관리자 전역 선택(OpenAI/Gemini)`으로 확정한다.
- 모델 타입 표준은 `text-small`, `text-large`, `image`로 고정한다.
- MVP에서는 자동 다중 공급자 폴백을 제외하고 운영자 수동 전환을 채택한다.

## MVP Scope
- 포함:
- 관리자 공급자 선택 UI/설정 저장.
- 공급자별 모델 매핑 관리.
- 신규 요청 기준 반영 정책.
- 설정 변경 이력/롤백.
- 비포함(Non-goal):
- 자동 장애 감지 후 공급자 자동 우회.
- 공급자별 동적 트래픽 분산/AB 라우팅.

## Success Metrics
- 공급자 전환 이후 24시간 오류율 변화.
- 모델 타입별 평균 응답 시간.
- 설정 변경 후 롤백 발생률.

## Open Questions
- 공급자별 모델명 업데이트 주기와 검증 프로세스.
- 관리자 권한 분리(읽기 전용 vs 변경 권한) 필요 여부.
- 전환 시 알림(운영 채널/대시보드 배너) 범위.

## Next Actions
- 운영 설정 스키마 확정: `provider`, `text_small_model`, `text_large_model`, `image_model`.
- 설정 변경 이력 테이블 및 감사 로그 설계.
- 전환/롤백 운영 런북 문서화.
- 모델 유효성 검사 규칙 정의.
