# spec-diary-mvp

## Problem
- 사용자는 일기를 쓰고 싶지만 문장으로 정리하는 데 시간이 많이 들어 기록 습관이 자주 끊긴다.
- 특히 바쁜 날에는 작성 시작 자체의 진입 장벽이 높아져 기록 공백이 생긴다.

## Target User
- 일기 기록 의지는 있지만 시간과 에너지가 부족한 사용자.
- 키워드나 짧은 문장 정도는 남길 수 있으나 완성된 글 작성은 부담스러운 사용자.

## User Value
- 짧은 입력만으로도 빠르게 일기 초안을 만들 수 있어 기록 지속성이 높아진다.
- 사용자 취향의 페르소나를 기반으로 일관된 톤의 일기를 작성할 수 있다.

## Use Cases
- 사용자가 키워드 N개만 입력하고 즉시 일기 초안을 생성한다.
- 사용자가 자연어로 오늘 일을 짧게 적고 선택한 페르소나 톤으로 일기를 생성한다.
- 사용자가 같은 일기장에서 상황에 따라 페르소나를 바꿔 일기 초안을 재생성한다.
- 사용자가 새 일기장 생성 시 템플릿 또는 LLM 대화로 페르소나를 만들고 이미지까지 생성한다.

## Corner Cases
- 입력이 비어 있거나 지나치게 짧아 생성 품질이 낮은 경우.
- 페르소나 이미지 생성이 실패하거나 지연되는 경우.
- 페르소나 전환 시 기존 draft가 있어 사용자가 의도치 않게 내용을 잃는 경우.
- LLM 대화 기반 페르소나 생성에서 필수 속성이 누락되는 경우.

## Behavior Spec
- 일기 작성 입력은 `키워드` 또는 `자연어` 중 하나 이상을 필수로 요구한다.
- 사용자는 계정 단위로 여러 페르소나를 보유할 수 있고, 일기장에는 여러 페르소나를 연결할 수 있다.
- 각 일기장은 기본 페르소나를 1개 지정하며, 작성 화면에서 연결된 페르소나를 전환할 수 있다.
- 페르소나 생성 방식은 3가지를 지원한다: 템플릿 선택, 템플릿 수정, LLM 대화 생성.
- 페르소나 생성 시 캐릭터 이미지 생성을 함께 시도한다.
- 이미지 생성 실패 시 자동 재시도(최대 3회) 후 실패 상태로 전환한다.
- 자동 재시도 실패 후 사용자는 수동 재시도를 실행할 수 있어야 한다.
- 이미지 생성 실패 상태여도 텍스트 페르소나는 저장 가능해야 하며, 이후 이미지 재생성을 지원한다.
- 페르소나 전환 시 기존 draft가 있으면 `유지`, `새 페르소나로 재생성`, `취소` 중 하나를 명시적으로 선택하게 한다.
- 일기 생성 실패(타임아웃/모델 오류) 시 재시도 버튼과 실패 사유를 제공한다.

## Cost and Complexity
- 높은 복잡도 요인:
- LLM 대화형 페르소나 생성과 일기 생성의 이중 생성 파이프라인 운영.
- 이미지 생성 비동기 처리 및 재시도 상태 관리.
- 페르소나(계정)와 일기장(매핑) 데이터 모델 분리.
- 낮은 비용 대안:
- 초기에는 페르소나를 고정 템플릿만 제공하고 이미지 생성을 제외해도 MVP 가치를 일부 검증할 수 있다.
- 비교 결과:
- 대안은 구현 비용이 낮지만 차별화(개인화/몰입감)와 장기 유지율 가설 검증력이 떨어진다.

## Usability
- 작성 화면에서 페르소나 선택 UI를 항상 노출하되, 기본값 자동 선택으로 마찰을 줄인다.
- 입력이 짧아도 바로 생성 가능하게 하여 진입 속도를 우선한다.
- 실패 상태(이미지/텍스트 생성)는 사용자 행동 가능한 버튼(재시도, 나중에) 중심으로 설계한다.

## Risks and Mitigations
- Risk: 기능 범위가 넓어 첫 릴리스 지연 가능성.
- Mitigation: 핵심 플로우(작성/저장) 우선 구현, 고급 옵션은 단계적으로 활성화.
- Risk: 페르소나 전환이 많아질수록 사용자 혼란 증가.
- Mitigation: 일기장 기본 페르소나 고정 + 전환 시 확인 모달 제공.
- Risk: 이미지 생성 실패율이 높아 UX 저하.
- Mitigation: 자동 재시도 + 수동 재시도 + 텍스트만 저장 허용으로 블로킹 제거.

## Decision
- 대주제는 `키워드/자연어 기반 일기 자동 작성`으로 고정한다.
- 기능 레벨은 `페르소나 기반 생성`, `일기장-페르소나 매핑`, `다중 페르소나 전환`, `페르소나 이미지 생성`으로 구성한다.
- 하위 정책은 `이미지 재시도`, `계정 소유 + 일기장 매핑`, `전환 시 draft 보호`를 채택한다.

## MVP Scope
- 포함:
- 키워드/자연어 입력 기반 일기 생성.
- 계정 단위 페르소나 생성/수정/조회.
- 일기장별 다중 페르소나 연결과 기본 페르소나 지정.
- 작성 중 페르소나 전환 및 전환 시 draft 처리 선택.
- 페르소나 이미지 생성 + 자동 재시도(최대 3회) + 수동 재시도.
- 비포함(Non-goal):
- 일기 내용 기반 장기 추세 기록/시각화.
- 주간/월간/연간 인사이트 리포트 생성.
- 페르소나 추천 자동화 및 고급 AB 테스트.

## Success Metrics
- 일기 생성 요청 대비 저장 완료율.
- 생성 시작부터 저장까지 평균 소요 시간.
- 페르소나 생성 완료율(이미지 포함/텍스트만).
- 이미지 생성 최종 성공률(자동+수동 재시도 포함).
- 작성 세션 내 페르소나 전환 사용률.

## Open Questions
- LLM 대화형 페르소나 생성의 최소/최대 턴 수를 몇으로 제한할지.
- 페르소나 이미지 생성 모델 선택과 비용 상한을 어떻게 둘지.
- 페르소나 전환 시 기존 draft 유지를 기본값으로 둘지, 재생성을 기본값으로 둘지.

## Next Actions
- 데이터 스키마 초안 작성: `personas`, `diaries`, `diary_personas`, `entries`.
- API 시나리오 정의: 생성/전환/재시도/저장 엔드포인트.
- 실패 상태 전이 다이어그램 정의: 이미지 생성 및 텍스트 생성 각각.
- MVP 수용 기준(인수 테스트 케이스) 작성.
