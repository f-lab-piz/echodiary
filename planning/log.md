# 플래닝 로그

## 2026-02-22 - 플래닝 워크스페이스 초기화

### 문제
- 아이데이션 노트를 구체적인 제품 계획으로 전환하는 반복 가능한 프로세스가 필요함.

### 대상 사용자
- 로드맵과 기능 우선순위를 정하는 프로젝트 오너.

### 사용자 가치
- 더 명확한 범위와 트레이드오프로 의사결정을 더 빠르게 수행함.

### 사용 사례
- 브레인스토밍 아이디어를 MVP 스펙으로 전환함.
- 가치, 비용, 위험 기준으로 옵션을 비교함.

### 코너 케이스
- 아이데이션 노트가 모호하거나 상충함.
- 사용자 가치는 낮은데 구현 비용은 높은 아이디어임.

### 동작 스펙
- 먼저 아이데이션 파일을 읽고, 이후 구조화된 플래닝 산출물을 작성함.

### 비용 및 복잡도
- 초기 설정 비용은 낮고, 세션별 지속 분석 노력은 중간 수준임.

### 사용성
- 안정적인 템플릿과 플래닝 파일의 일관된 업데이트가 필요함.

### 위험 및 대응
- 위험: 산출물이 추상적으로 남을 수 있음. 대응: 인수 기준과 명시적 동작을 강제함.

### 결정
- `planning/`에 인덱스 + 로그 + 토픽 스펙 형태로 플래닝 산출물을 저장함.

### MVP 범위
- 플래닝 워크스페이스와 첫 플래닝 스킬을 초기화함.

### 성공 지표
- 각 세션이 실행 가능한 스펙 후보 1개로 종료됨.

### 열린 질문
- 첫 번째 스펙 주제는 무엇이어야 하는가?

### 다음 액션
- 첫 아이데이션-플래닝 세션을 진행함.

## 2026-02-22 - Ideation 1번 MVP 플래닝

### Problem
- 사용자는 일기를 쓰고 싶어도 문장화 부담과 시간 부족으로 기록 습관이 중단된다.
- 짧은 입력으로 즉시 초안을 얻는 경험이 없으면 재방문 동기가 낮아진다.

### Target User
- 기록 의지는 있으나 작성 시간이 부족한 사용자.
- 키워드/짧은 문장 입력은 가능하지만 완성된 글 작성이 부담스러운 사용자.

### User Value
- 짧은 입력만으로 빠르게 일기 초안을 얻어 기록 지속성이 향상된다.
- 페르소나를 통해 본인 취향에 맞는 일관된 글 톤을 유지할 수 있다.

### Use Cases
- 키워드 입력으로 즉시 일기 생성 후 저장.
- 자연어 메모 입력 후 페르소나를 바꿔 재생성.
- 일기장 생성 시 새 페르소나를 만들고 이미지까지 생성.

### Corner Cases
- 빈 입력 또는 품질이 낮은 입력.
- 이미지 생성 실패/지연.
- 페르소나 전환 시 기존 draft 손실 위험.

### Behavior Spec
- 계정 단위 페르소나 소유 + 일기장 단위 매핑을 채택함.
- 페르소나 생성은 템플릿/수정/LLM 대화 방식을 모두 허용함.
- 이미지 생성 실패는 자동 재시도(최대 3회) 후 수동 재시도를 지원함.
- 전환 시 draft 처리 선택을 명시적으로 요구함.

### Cost and Complexity
- 고비용 요소는 LLM 대화 생성, 이미지 생성 파이프라인, 매핑 모델 설계임.
- 저비용 대안(템플릿 전용 + 이미지 미포함)은 구현은 빠르나 차별화 검증력이 낮음.

### Usability
- 기본 페르소나 자동 선택으로 작성 진입 마찰을 줄임.
- 실패 상태는 재시도 중심 UX로 복구 가능성을 명확히 제공함.

### Risks and Mitigations
- 범위 확장으로 일정 지연 위험이 있어 단계적 출시 전략을 유지함.
- 이미지 생성 실패에 대비해 텍스트만 저장 가능한 우회 경로를 제공함.

### Decision
- 대주제는 Ideation 1번(`키워드/자연어 기반 일기 자동 작성`)으로 고정함.
- 하위 기능과 정책을 포함한 상세 스펙을 `planning/spec-diary-mvp.md`로 분리 작성함.

### MVP Scope
- 포함: 생성, 페르소나 다중 관리/전환, 이미지 생성 재시도.
- 비포함: 추세 기록/인사이트 리포트(2차/3차 항목).

### Success Metrics
- 생성 대비 저장 완료율.
- 생성-저장 평균 시간.
- 페르소나/이미지 생성 성공률.

### Open Questions
- 대화형 생성 턴 수 제한.
- 이미지 생성 비용 상한.
- 전환 시 draft 기본 처리 정책.

### Next Actions
- 데이터 스키마 및 API 시나리오 설계.
- 상태 전이/인수 테스트 기준 정의.

## 2026-02-22 - LLM 공급자 전역 운영 정책 추가

### Problem
- 모델 공급자와 모델 타입 선택 기준이 없으면 운영 중 비용/품질/장애 대응이 불안정해진다.

### Target User
- 서비스를 운영하는 관리자 계정.
- 간접적으로는 일기 생성 기능을 사용하는 전체 사용자.

### User Value
- 운영자는 공급자 전환을 단일 설정으로 관리할 수 있고, 사용자는 일관된 생성 경험을 받는다.

### Use Cases
- 관리자가 OpenAI/Gemini 중 하나를 선택해 서버 전체 요청 경로를 전환한다.
- 일기 생성은 `text-small`, 재생성/고품질 요청은 `text-large`, 이미지 생성은 `image`로 라우팅한다.

### Corner Cases
- 공급자 전환 시점과 실행 중 요청이 겹치는 경우.
- 선택 공급자의 특정 모델 타입이 일시 장애인 경우.

### Behavior Spec
- 관리자 전역 설정으로 공급자 1개를 선택하고 신규 요청부터 반영한다.
- 실행 중 요청은 기존 공급자로 완료 처리한다.
- 모델은 공통 타입(`text-small`, `text-large`, `image`)으로 추상화하고 공급자별 모델명 매핑으로 실행한다.
- 자동 타 공급자 폴백은 MVP에서 제외한다.

### Cost and Complexity
- 다중 공급자 지원은 매핑/정규화/운영 절차 비용이 증가한다.
- 저비용 대안(단일 공급자 고정)은 단순하지만 장애/비용 리스크 대응력이 낮다.

### Usability
- 사용자는 공급자 변경을 인지하지 않아도 동일한 기능 흐름을 유지한다.
- 실패 시 재시도 중심 메시지로 사용자 행동 경로를 명확히 한다.

### Risks and Mitigations
- Risk: 공급자별 응답 형식 차이로 품질 편차 발생.
- Mitigation: 공통 프롬프트 스키마와 출력 정규화 레이어 적용.
- Risk: 공급자 장애 시 가용성 하락.
- Mitigation: 빠른 실패 + 운영자 수동 전환 절차 문서화.

### Decision
- 공급자는 OpenAI/Gemini 2개를 지원하고, 관리자 전역 선택으로 서버 전체 동작을 결정한다.
- 모델 타입은 `text-small`, `text-large`, `image` 3종으로 표준화한다.

### MVP Scope
- 포함: 전역 공급자 선택, 모델 매핑, 모델 타입별 라우팅.
- 비포함: 자동 다중 공급자 폴백/자동 우회.

### Success Metrics
- 공급자 전환 후 오류율 변동.
- 모델 타입별 평균 응답시간과 실패율.

### Open Questions
- 공급자별 실제 모델명 버전 업데이트 주기.
- 전환 후 품질 회귀 점검 체크리스트의 자동화 범위.

### Next Actions
- 운영 설정 스키마(`provider`, `text_small_model`, `text_large_model`, `image_model`) 확정.
- 전환/롤백 런북과 점검 항목 정의.

## 2026-02-22 - 플래닝 문서 분리 구조 확정

### Problem
- 단일 통합 스펙 파일에 사용자 기능과 관리자 기능이 함께 있어 탐색과 유지보수가 어려움.

### Target User
- 기획/개발/운영 문서를 함께 사용하는 프로젝트 팀.

### User Value
- 기능별 문서를 분리해 의사결정과 구현 범위를 빠르게 파악할 수 있다.

### Use Cases
- 개발자는 `spec-diary-writing`만 읽고 사용자 기능을 구현한다.
- 운영자는 `spec-admin-llm-provider`만 읽고 관리자 기능을 운영한다.

### Corner Cases
- 분리 후 기존 통합 문서와 최신 문서 간 내용 불일치 가능성.

### Behavior Spec
- `planning/README.md`를 메인 진입점으로 사용한다.
- 사용자 기능은 `planning/spec-diary-writing.md`로 관리한다.
- 관리자 기능은 `planning/spec-admin-llm-provider.md`로 관리한다.
- 기존 `planning/spec-diary-mvp.md`는 참고용 통합본으로 유지한다.

### Cost and Complexity
- 초기 분리 작업 비용은 낮고, 이후 변경 전파 규칙만 지키면 유지 비용이 줄어든다.

### Usability
- 문서 읽는 순서를 `README`에 고정해 온보딩 시간을 줄인다.

### Risks and Mitigations
- Risk: 통합본과 분리본 중 어디를 수정해야 할지 혼선.
- Mitigation: 통합본 상단에 분리 상태와 우선 참조 파일을 명시한다.

### Decision
- 플래닝 문서는 메인 README + 기능별 스펙 2개 구조로 운영한다.

### MVP Scope
- 포함: README 신설, 기능별 스펙 분리, 인덱스 참조 갱신.
- 비포함: 통합본 삭제.

### Success Metrics
- 신규 작업자가 필요한 스펙을 찾는 시간.
- 스펙 변경 시 수정 파일 수 감소 여부.

### Open Questions
- 향후 추세/인사이트 기능 스펙을 별도 파일로 언제 분리할지.

## 2026-02-26 - 개발 인프라/CI-CD/AWS 전환 플래닝 추가

### Problem
- 기능 스펙 대비 개발/배포/운영 인프라 기준이 문서화되지 않아 구현 우선순위와 운영 안정성 기준이 불명확함.
- 로컬 개발 환경과 AWS 운영 환경 간 차이를 사전에 정의하지 않으면 전환 시 리스크가 커짐.

### Target User
- EchoDiary를 개발/배포/운영하는 1인 개발자.

### User Value
- 로컬 개발 속도를 유지하면서도 운영 환경(EC2/RDS)으로 자연스럽게 전환 가능함.
- CI/CD와 모니터링 기준이 명확해 배포 실패와 장애 대응 시간을 줄임.

### Use Cases
- Docker Compose로 로컬에서 FastAPI/Postgres/Prometheus/Grafana를 실행함.
- GitHub Actions로 테스트/빌드/이미지 푸시를 자동화함.
- ArgoCD로 GitOps 기반 배포 동기화를 수행함.
- 운영 중 Grafana 대시보드로 지연/오류/DB 상태를 모니터링함.

### Corner Cases
- 로컬/운영 DB 설정 차이로 마이그레이션 실패.
- EC2 배포 중 헬스체크 실패.
- RDS 연결 제한 초과.
- Prometheus 스크랩 실패로 관측 공백 발생.

### Behavior Spec
- 기술 스택은 FastAPI, Postgres, Docker, GitHub Actions, ArgoCD, Prometheus, Grafana를 사용함.
- 개발 중에는 로컬 Compose 중심으로 운영하고, 운영 단계에서 AWS EC2/RDS로 이관함.
- 시크릿은 Git에 저장하지 않고 환경별 시크릿 저장소를 사용함.
- 기본 모니터링 지표(API RPS, p95, error rate, DB 연결 수)를 표준화함.

### Cost and Complexity
- ArgoCD/AWS/모니터링 운영 비용으로 초기 복잡도가 증가함.
- 저비용 대안(단일 EC2 + 수동 배포)은 빠르지만 추적성과 안정성이 낮음.

### Usability
- 로컬 실행은 단일 명령(`docker compose up`)으로 시작 가능하게 설계함.
- CI 실패 원인은 PR에서 바로 확인 가능하도록 함.

### Risks and Mitigations
- Risk: 인프라 범위 확장으로 일정 지연.
- Mitigation: 로컬+CI -> AWS 배포 -> 모니터링 고도화 순으로 단계 분리.
- Risk: 파이프라인 복잡도 상승.
- Mitigation: main 기준 단일 배포 경로와 템플릿화 적용.

### Decision
- 인프라 표준 스택과 AWS 전환 전략을 별도 스펙(`planning/spec-dev-infra.md`)으로 고정함.

### MVP Scope
- 포함: 로컬 Compose, CI 파이프라인, ArgoCD 배포 경로, EC2/RDS 전환 원칙.
- 비포함: 멀티리전/고급 오토스케일링/분산 트레이싱.

### Success Metrics
- 개발환경 세팅 시간.
- CI 성공률/평균 수행 시간.
- 배포 성공률/복구 시간.

### Open Questions
- 초기 ArgoCD 대상 런타임(EC2 단일 vs K8s).
- 이미지 레지스트리 선택(GHCR vs ECR).
- 모니터링 장기 보관 전략.

### Next Actions
- docker-compose, CI 워크플로우, ArgoCD 매니페스트 구조 초안 작성.

### Next Actions
- 이후 플래닝 변경은 분리본 우선 수정 원칙을 적용한다.
