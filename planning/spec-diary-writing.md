# spec-diary-writing

## Problem
- 사용자는 일기를 쓰고 싶지만 문장화에 시간이 많이 들어 기록 습관이 자주 끊긴다.
- 바쁜 날에는 작성 시작 자체가 어렵다.

## Target User
- 기록 의지는 있지만 시간과 에너지가 부족한 사용자.
- 키워드/짧은 문장은 입력할 수 있지만 완성 글 작성이 부담스러운 사용자.

## User Value
- 짧은 입력만으로 빠르게 일기 초안을 얻어 기록 지속성을 높인다.
- 페르소나 기반으로 사용자 취향에 맞는 일관된 톤을 유지한다.

## Use Cases
- 키워드 입력 후 즉시 일기 초안을 생성하고 저장한다.
- 자연어 메모 입력 후 페르소나를 바꿔 재생성한다.
- 새 일기장 생성 시 템플릿 또는 LLM 대화로 페르소나를 만들고 이미지까지 생성한다.

## Corner Cases
- 입력이 비어 있거나 과도하게 짧아 품질이 낮은 경우.
- 이미지 생성 실패/지연.
- 페르소나 전환 시 기존 draft 손실 위험.
- LLM 대화 생성에서 필수 페르소나 속성 누락.

## Behavior Spec
- 일기 작성 입력은 `키워드` 또는 `자연어` 중 하나 이상 필수다.
- 사용자는 계정 단위로 여러 페르소나를 보유할 수 있고, 일기장에는 여러 페르소나를 연결할 수 있다.
- 각 일기장은 기본 페르소나 1개를 지정한다.
- 작성 화면에서 연결된 페르소나를 전환할 수 있다.
- 페르소나 생성 방식은 `템플릿 선택`, `템플릿 수정`, `LLM 대화 생성`을 지원한다.
- 페르소나 생성 시 캐릭터 이미지 생성을 시도한다.
- 이미지 생성 실패 시 자동 재시도(최대 3회) 후 실패 상태로 전환한다.
- 자동 재시도 실패 후 사용자는 수동 재시도를 실행할 수 있다.
- 이미지 실패 상태여도 텍스트 페르소나는 저장 가능해야 하며, 이후 이미지 재생성을 지원한다.
- 페르소나 전환 시 기존 draft가 있으면 `유지`, `새 페르소나로 재생성`, `취소`를 명시적으로 선택한다.
- 일기 생성 실패(타임아웃/모델 오류) 시 재시도 버튼과 실패 사유를 제공한다.

## Cost and Complexity
- 고비용 요소는 LLM 대화 생성, 이미지 비동기 처리/재시도, 계정-일기장 매핑 모델이다.
- 저비용 대안은 템플릿 전용 + 이미지 미포함이다.
- 대안은 구현은 빠르지만 개인화 차별화 검증력이 낮다.

## Usability
- 기본 페르소나 자동 선택으로 진입 마찰을 줄인다.
- 입력이 짧아도 즉시 생성 가능하게 한다.
- 실패 상태는 재시도 중심 UX로 복구 경로를 명확히 제공한다.

## Risks and Mitigations
- Risk: 범위 확장으로 일정 지연.
- Mitigation: 작성/저장 핵심 플로우 우선 구현, 고급 옵션 단계적 활성화.
- Risk: 페르소나 전환 증가로 사용자 혼란.
- Mitigation: 기본 페르소나 고정 + 전환 확인 모달.
- Risk: 이미지 실패율로 UX 저하.
- Mitigation: 자동/수동 재시도 + 텍스트 저장 허용.

## Decision
- 대주제는 `키워드/자연어 기반 일기 자동 작성`으로 고정한다.
- 하위 기능은 페르소나 생성/연결/전환/이미지 생성으로 구성한다.
- 하위 정책은 `이미지 재시도`, `계정 소유 + 일기장 매핑`, `draft 보호`를 채택한다.

## MVP Scope
- 포함:
- 키워드/자연어 입력 기반 일기 생성.
- 계정 단위 페르소나 생성/수정/조회.
- 일기장별 다중 페르소나 연결과 기본 페르소나 지정.
- 작성 중 페르소나 전환 및 전환 시 draft 처리 선택.
- 페르소나 이미지 생성 + 자동 재시도(최대 3회) + 수동 재시도.
- 비포함(Non-goal):
- 장기 추세 기록/시각화.
- 주간/월간/연간 인사이트 리포트.

## Success Metrics
- 일기 생성 요청 대비 저장 완료율.
- 생성 시작부터 저장까지 평균 시간.
- 페르소나 생성 완료율(이미지 포함/텍스트만).
- 이미지 생성 최종 성공률.
- 작성 세션 내 페르소나 전환 사용률.

## Open Questions
- LLM 대화형 페르소나 생성의 최소/최대 턴 제한.
- 페르소나 전환 시 draft 기본값(`유지`/`재생성`).
- 이미지 생성 프롬프트 가이드라인 표준화 방식.

## Next Actions
- 데이터 스키마 확정: `personas`, `diaries`, `diary_personas`, `entries`.
- API 시나리오 확정: 생성/전환/재시도/저장.
- 상태 전이 다이어그램 작성(텍스트/이미지 생성 각각).
- MVP 인수 테스트 케이스 작성.
